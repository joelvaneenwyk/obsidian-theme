/*
* Fixes to Embed
*/

@import "lib/root.scss";

body {
    --icon-size-override: 32px;
    --icon-padding: 8px;
    --icon-left-offset: calc((var(--icon-size-override) - var(--icon-size)) / 2);
    --embed-border-left-size: calc(var(--icon-size) + var(--icon-padding) * 2);
    --embed-border-padding: 4px;
}

div.cm-embed-block.markdown-rendered div.callout {
    padding-left: calc(var(--icon-size) + var(--icon-padding) * 2) !important;
}

.markdown-source-view.mod-cm6.is-readable-line-width table {
    width: calc(var(--max-width) - var(--folding-offset)) !important;
    max-width: calc(var(--max-width) - var(--folding-offset)) !important;
    margin-right: auto;
    margin-left: var(--folding-offset) !important;
}

.file-embed-link,
.markdown-embed-link {
    top: 0;
    right: 0;
    left: var(--embed-border-padding);
    text-align: left;
    justify-content: flex-start;
}

div.markdown-embed-content div.markdown-preview-section div > p {
    margin-top: var(--embed-border-padding);
}

div.markdown-embed-content div.markdown-preview-section div.mod-header + div > * {
    margin-top: 0px !important;
}

/* TODO prevent hiding when under `div.HyperMD-quote` */
/*
span.cm-html-embed,
span.cm-html-embed > *,
span.cm-html-embed + img.cm-widgetBuffer,
span.cm-html-embed + img.cm-widgetBuffer + img.cm-widgetBuffer,
div.cm-line > img.cm-widgetBuffer {
    visibility: hidden !important;
    display: block;
    position: absolute;
    height: 0 !important;
    box-sizing: revert !important;
    margin: 0 !important;
}
*/

div.oz-custom-html-widget-cm6 {
    padding: 0 !important;
}

.inline-embed .markdown-embed-content p:first-child {
    margin-top: revert !important;
}

div.callout.admonition.admonition-info.admonition-plugin {
    margin-top: revert;
    margin-bottom: revert;
}

div.cm-contentContainer
    div.cm-preview-code-block.cm-embed-block.markdown-rendered.admonition-parent.admonition-info-parent
    + div.cm-line {
    margin-top: var(--embed-border-padding);
    /* visibility: hidden; */
}

div.cm-line:has(+ div.internal-embed.markdown-embed.inline-embed.is-loaded) {
    border-bottom-width: 2px !important;
    border-bottom-style: dotted !important;
    margin-top: var(--embed-border-padding) !important;
    margin-bottom: var(--embed-border-padding) !important;
    /* height: 5px; */
    /* border-top-color: 2px !important; */
}

.markdown-embed,
.markdown-embed-content {
    background-color: rgb(46, 46, 46) !important;
}

.embed-strict .markdown-embed-content {
    --folding-offset: 0;
}
.embed-strict .el-embed-heading.el-p > p {
    margin-block-start: 0;
    margin-block-end: 0;
}

.embed-strict .internal-embed .markdown-embed,
.embed-strict .markdown-preview-view .markdown-embed,
.embed-strict.markdown-preview-view .markdown-embed {
    padding: 0;
}

.embed-strict .internal-embed:not([src*="#^"]) .markdown-embed-link {
    width: var(--embed-border-left-size);
    opacity: 1;
}
.embed-underline .internal-embed {
    text-decoration-line: underline;
    text-decoration-style: var(--embed-decoration-style);
    text-decoration-color: var(--embed-decoration-color);
}
.embed-hide-title .markdown-embed-title {
    display: none;
}

.contextual-typography .embed-strict .internal-embed .markdown-preview-view .markdown-preview-sizer > div,
.embed-strict.contextual-typography .internal-embed .markdown-preview-view .markdown-preview-sizer > div {
    margin: 0;
    width: 100%;
}

.markdown-embed .markdown-preview-view .markdown-preview-sizer {
    padding-bottom: 0 !important;
}

.markdown-preview-view.is-readable-line-width .markdown-embed .markdown-preview-sizer,
.markdown-preview-view.markdown-embed .markdown-preview-sizer {
    max-width: 100%;
    width: 100%;
    min-height: 0 !important;
    padding-bottom: 0 !important;
}
.markdown-embed .markdown-preview-section div:last-child p,
.markdown-embed .markdown-preview-section div:last-child ul {
    margin-block-end: 2px;
}

.markdown-preview-view .markdown-embed {
    margin-top: var(--nested-padding);
    padding: 0 calc(var(--nested-padding) / 2) 0 var(--nested-padding);
}

.internal-embed:not([src*="#^"]) .markdown-embed-link {
    right: 0;
    width: 100%;
}

.file-embed-link,
.markdown-embed-link {
    top: 0;
    right: 0;
    text-align: left;
    justify-content: flex-start;
    margin-top: var(--embed-border-padding);
    margin-bottom: var(--embed-border-padding) !important;
    padding-bottom: var(--embed-border-padding) !important;
}

.file-embed-link svg,
.markdown-embed-link svg {
    width: var(--icon-size);
    height: var(--icon-size);
}

.markdown-embed .file-embed-link,
.markdown-embed .markdown-embed-link {
    opacity: 0.6;
    /* transition: opacity 1s linear; */
}
.markdown-embed .file-embed-link:hover,
.markdown-embed .markdown-embed-link:hover {
    opacity: 1;
}

.markdown-embed .file-embed-link:hover:hover,
.markdown-embed .markdown-embed-link:hover:hover {
    background-color: transparent;
    --icon-color: var(--text-accent);
}
.file-embed-link:hover,
.markdown-embed-link:hover {
    color: var(--text-muted);
}

.cm-embed-block > .edit-block-button,
div.edit-block-button {
    margin-left: max(
        calc(50% + var(--folding-offset) - var(--line-width-adaptive) / 2),
        calc(50% + var(--folding-offset) - var(--max-width) / 2)
    ) !important;
}

.markdown-source-view.mod-cm6 .edit-block-button {
    cursor: var(--cursor);
    color: var(--text-faint);
    background-color: var(--background-secondary);
    top: 0;
    max-width: calc(var(--max-width) - var(--folding-offset));
    right: auto;
    left: max(
        calc(50% + var(--folding-offset) - var(--line-width-adaptive) / 2 - var(--icon-size-override) - 4px),
        calc(50% + (var(--folding-offset) - var(--max-width) / 2) - var(--icon-size-override) - 4px)
    ) !important;
    opacity: 1;
    transition: opacity 0.2s;
}

.markdown-source-view.mod-cm6 .edit-block-button svg {
    margin: 0 !important;
    margin-left: var(--icon-left-offset) !important;
}

.markdown-source-view.mod-cm6.is-live-preview.is-readable-line-width .cm-embed-block > .edit-block-button {
    width: var(--icon-size-override) !important;
    padding-left: 0px !important;
    transform: none !important;
    margin-left: 0 !important;
}
.is-live-preview:not(.is-readable-line-width) .cm-embed-block > .edit-block-button {
    padding-left: 0 !important;
    margin-left: 0 !important;
    transform: none !important;
    right: 0;
    left: auto;
    padding: 4px;
}

.markdown-source-view.mod-cm6 .edit-block-button:hover {
    background-color: var(--background-secondary);
    color: var(--text-muted);
}

.markdown-source-view.mod-cm6 .edit-block-button svg {
    opacity: 1;
}

.markdown-source-view.mod-cm6 .edit-block-button:hover svg {
    opacity: 1;
}

div.callout-content {
    overflow: visible;

    p {
        margin-bottom: 0;
    }
}

div.admonition-content-copy {
    opacity: 0.9;
    transition: 0.6s opacity ease-in;
    display: inline-block;
    position: absolute;
    margin: 0;
    padding: 0;
    right: 0 !important;
    left: calc(0px - (var(--embed-border-left-size) - var(--icon-size)) / 2 - var(--icon-size)) !important;
    top: calc(0px - var(--icon-size) - (18px - var(--icon-size)) / 2 - 0.15em - 2px);
    bottom: 0 !important;
    overflow: hidden;
}

svg {
    overflow: visible;
}

.admonition-content-copy:hover {
    color: var(--text-normal);
}

.is-live-preview .admonition-content p {
    line-height: inherit;
    margin: 0;
    margin-top: 0;
    margin-right: 0;
    margin-bottom: 0;
    margin-left: 0;
}

.is-live-preview .admonition-content:last-child {
    margin-bottom: 0;
}

.admonition:hover .admonition-content-copy,
.callout:hover .admonition-content-copy,
.admonition-content-copy:hover {
    opacity: 1;
    transition: 0.6s opacity ease-in;
}
